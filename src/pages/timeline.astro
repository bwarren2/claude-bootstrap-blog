---
import BaseLayout from "@layouts/BaseLayout.astro";
import TimelineEntry from "@components/TimelineEntry.astro";
import { getCollection } from "astro:content";

const allProjects = await getCollection("projects", ({ data }) => !data.draft);
const projects = allProjects.sort(
  (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime(),
);

// Group by year-month
const grouped = new Map<string, typeof projects>();
for (const project of projects) {
  const key = project.data.pubDate.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
  });
  const existing = grouped.get(key) || [];
  existing.push(project);
  grouped.set(key, existing);
}
---

<BaseLayout
  title="Timeline"
  description="A chronological view of all projects built with Claude Code."
>
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl font-bold text-text-primary mb-2">Timeline</h1>
    <p class="text-lg text-text-secondary mb-8">
      Every project, in chronological order.
    </p>

    {
      [...grouped.entries()].map(([monthYear, monthProjects]) => (
        <div class="mb-8">
          <h2 class="text-lg font-semibold text-text-primary mb-4">{monthYear}</h2>
          <div>
            {monthProjects.map((project) => (
              <TimelineEntry project={project} />
            ))}
          </div>
        </div>
      ))
    }
  </div>
</BaseLayout>
